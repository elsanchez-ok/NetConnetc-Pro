<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetConnect Pro | Nuevo Cliente</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Variables de tema */
        :root {
            --gradient-primary: linear-gradient(135deg, #0a0f2d 0%, #1a237e 30%, #283593 60%, #3949ab 100%);
            --gradient-card: linear-gradient(145deg, rgba(255,255,255,0.98) 0%, rgba(248,250,255,0.98) 100%);
            --color-light: #f8faff;
            --color-white: #ffffff;
            --color-text: #1a202c;
            --color-border: #e2e8f0;
            --color-admin: #7c3aed;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --shadow-card: 0 10px 25px rgba(0, 0, 0, 0.08);
            --radius-card: 20px;
            --radius-button: 12px;
            --transition-smooth: all 0.3s ease;
        }

        [data-theme="dark"] {
            --gradient-card: linear-gradient(145deg, rgba(30,30,50,0.95) 0%, rgba(26,26,46,0.98) 100%);
            --color-light: #12122e;
            --color-white: #1a1a3e;
            --color-text: #f7fafc;
            --color-border: rgba(255,255,255,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--color-light);
            color: var(--color-text);
            transition: var(--transition-smooth);
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #0a0f2d 0%, #1a237e 100%);
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            z-index: 1000;
            transition: var(--transition-smooth);
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.1);
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            transition: var(--transition-smooth);
            min-height: 100vh;
        }

        .sidebar.collapsed ~ .main-content {
            margin-left: 80px;
        }

        .main-header {
            background: var(--gradient-card);
            padding: 0 30px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .theme-toggle {
            background: var(--gradient-admin);
            border: none;
            color: white;
            width: 45px;
            height: 45px;
            border-radius: var(--radius-button);
            cursor: pointer;
            transition: var(--transition-smooth);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .content-wrapper {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .form-header {
            background: var(--gradient-card);
            border-radius: var(--radius-card);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-card);
            border: 1px solid var(--color-border);
            text-align: center;
        }

        .new-client-form {
            background: var(--gradient-card);
            border-radius: var(--radius-card);
            padding: 40px;
            box-shadow: var(--shadow-card);
            border: 1px solid var(--color-border);
            margin-bottom: 30px;
        }

        .form-section {
            margin-bottom: 40px;
            padding-bottom: 40px;
            border-bottom: 2px solid var(--color-border);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .form-input {
            padding: 16px 20px;
            background: var(--color-white);
            border: 2px solid var(--color-border);
            border-radius: 10px;
            color: var(--color-text);
            font-size: 16px;
            transition: var(--transition-smooth);
            width: 100%;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-admin);
            box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.15);
        }

        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .plan-card {
            background: var(--color-white);
            border: 3px solid var(--color-border);
            border-radius: var(--radius-card);
            padding: 30px;
            cursor: pointer;
            transition: var(--transition-smooth);
            position: relative;
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
        }

        .plan-card.selected {
            border-color: var(--color-admin);
            background: rgba(124, 58, 237, 0.05);
        }

        .plan-card .selected-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--gradient-admin);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 800;
            display: none;
        }

        .plan-card.selected .selected-badge {
            display: block;
        }

        .plan-select-btn {
            width: 100%;
            padding: 15px;
            background: var(--color-admin);
            color: white;
            border: none;
            border-radius: var(--radius-button);
            font-weight: 800;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .plan-card.selected .plan-select-btn {
            background: var(--gradient-success);
        }

        .plan-summary {
            background: var(--color-white);
            border-radius: var(--radius-card);
            padding: 30px;
            margin-top: 30px;
            border: 2px solid var(--color-admin);
            box-shadow: 0 10px 30px rgba(124, 58, 237, 0.1);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 16px 35px;
            border-radius: var(--radius-button);
            font-weight: 800;
            cursor: pointer;
            transition: var(--transition-smooth);
            border: none;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            min-width: 160px;
        }

        .btn-primary {
            background: var(--gradient-success);
            color: white;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
        }

        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: var(--shadow-card);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }

        .notification.success {
            background: var(--gradient-success);
            color: white;
        }

        .notification.error {
            background: var(--gradient-danger);
            color: white;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div style="padding: 25px 20px;">
                <div style="color: white; font-weight: 800; font-size: 18px;">NETCONNECT PRO</div>
            </div>
            <ul style="list-style: none; padding: 20px 0;">
                <li><a href="clientes.html" style="display: flex; align-items: center; padding: 15px 25px; color: rgba(255,255,255,0.8); text-decoration: none;"><i class="fas fa-users" style="margin-right: 15px;"></i> Clientes</a></li>
                <li><a href="#" style="display: flex; align-items: center; padding: 15px 25px; background: var(--color-admin); color: white; text-decoration: none;"><i class="fas fa-user-plus" style="margin-right: 15px;"></i> Nuevo Cliente</a></li>
            </ul>
        </aside>

        <!-- Contenido principal -->
        <main class="main-content">
            <header class="main-header">
                <div>
                    <h1>Nuevo Cliente</h1>
                    <p>Registra un nuevo cliente en el sistema</p>
                </div>
                <div>
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-sun"></i>
                    </button>
                </div>
            </header>

            <div class="content-wrapper">
                <div class="form-header">
                    <h2><i class="fas fa-user-plus"></i> Registro de Nuevo Cliente</h2>
                    <p>Completa todos los campos requeridos para registrar un nuevo cliente</p>
                </div>

                <form class="new-client-form" id="newClientForm">
                    <!-- Información Personal -->
                    <div class="form-section">
                        <h3 style="margin-bottom: 20px; font-size: 22px;">Información Personal</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Primer Nombre *</label>
                                <input type="text" class="form-input" id="firstName" placeholder="Ej: Juan" required>
                            </div>
                            <div class="form-group">
                                <label>Primer Apellido *</label>
                                <input type="text" class="form-input" id="firstLastName" placeholder="Ej: Pérez" required>
                            </div>
                            <div class="form-group">
                                <label>Correo Electrónico *</label>
                                <input type="email" class="form-input" id="email" placeholder="cliente@ejemplo.com" required>
                            </div>
                            <div class="form-group">
                                <label>Teléfono *</label>
                                <input type="tel" class="form-input" id="phone" placeholder="+504 XXXX-XXXX" required>
                            </div>
                            <div class="form-group">
                                <label>Dirección Completa *</label>
                                <input type="text" class="form-input" id="address" placeholder="Colonia, ciudad, departamento" required>
                            </div>
                        </div>
                    </div>

                    <!-- Selección de Plan -->
                    <div class="form-section">
                        <h3 style="margin-bottom: 20px; font-size: 22px;">Selección de Plan</h3>
                        
                        <div class="plans-grid" id="plansContainer">
                            <!-- Plan Básico -->
                            <div class="plan-card selected" data-plan="basic" data-price="699">
                                <div class="selected-badge">
                                    <i class="fas fa-check"></i> SELECCIONADO
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <div style="font-size: 22px; font-weight: 800; color: var(--color-text); margin-bottom: 10px;">Plan Básico</div>
                                    <div style="font-size: 32px; font-weight: 900; color: var(--color-admin);">L 699<span style="font-size: 16px; color: var(--color-text-light);">/mes</span></div>
                                </div>
                                <ul style="list-style: none; margin-bottom: 25px;">
                                    <li style="padding: 10px 0; border-bottom: 1px solid var(--color-border); display: flex; align-items: center; gap: 12px;"><i class="fas fa-check" style="color: var(--color-success);"></i> 100 Mbps Simétricos</li>
                                    <li style="padding: 10px 0; border-bottom: 1px solid var(--color-border); display: flex; align-items: center; gap: 12px;"><i class="fas fa-check" style="color: var(--color-success);"></i> 120 Canales HD</li>
                                    <li style="padding: 10px 0; border-bottom: 1px solid var(--color-border); display: flex; align-items: center; gap: 12px;"><i class="fas fa-check" style="color: var(--color-success);"></i> WiFi 6 Router</li>
                                </ul>
                                <button type="button" class="plan-select-btn">
                                    Seleccionar Plan
                                </button>
                            </div>
                            
                            <!-- Plan Familiar -->
                            <div class="plan-card" data-plan="family" data-price="1199">
                                <div class="selected-badge">
                                    <i class="fas fa-check"></i> SELECCIONADO
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <div style="font-size: 22px; font-weight: 800; color: var(--color-text); margin-bottom: 10px;">Plan Familiar Pro</div>
                                    <div style="font-size: 32px; font-weight: 900; color: var(--color-admin);">L 1,199<span style="font-size: 16px; color: var(--color-text-light);">/mes</span></div>
                                </div>
                                <ul style="list-style: none; margin-bottom: 25px;">
                                    <li style="padding: 10px 0; border-bottom: 1px solid var(--color-border); display: flex; align-items: center; gap: 12px;"><i class="fas fa-check" style="color: var(--color-success);"></i> 300 Mbps Simétricos</li>
                                    <li style="padding: 10px 0; border-bottom: 1px solid var(--color-border); display: flex; align-items: center; gap: 12px;"><i class="fas fa-check" style="color: var(--color-success);"></i> 180 Canales HD/4K</li>
                                    <li style="padding: 10px 0; border-bottom: 1px solid var(--color-border); display: flex; align-items: center; gap: 12px;"><i class="fas fa-check" style="color: var(--color-success);"></i> WiFi Mesh System</li>
                                </ul>
                                <button type="button" class="plan-select-btn">
                                    Seleccionar Plan
                                </button>
                            </div>
                            
                            <!-- Plan Premium -->
                            <div class="plan-card" data-plan="premium" data-price="1999">
                                <div class="selected-badge">
                                    <i class="fas fa-check"></i> SELECCIONADO
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <div style="font-size: 22px; font-weight: 800; color: var(--color-text); margin-bottom: 10px;">Plan Premium Ultra</div>
                                    <div style="font-size: 32px; font-weight: 900; color: var(--color-admin);">L 1,999<span style="font-size: 16px; color: var(--color-text-light);">/mes</span></div>
                                </div>
                                <ul style="list-style: none; margin-bottom: 25px;">
                                    <li style="padding: 10px 0; border-bottom: 1px solid var(--color-border); display: flex; align-items: center; gap: 12px;"><i class="fas fa-check" style="color: var(--color-success);"></i> 1 Gbps Simétricos</li>
                                    <li style="padding: 10px 0; border-bottom: 1px solid var(--color-border); display: flex; align-items: center; gap: 12px;"><i class="fas fa-check" style="color: var(--color-success);"></i> 220 Canales 4K</li>
                                    <li style="padding: 10px 0; border-bottom: 1px solid var(--color-border); display: flex; align-items: center; gap: 12px;"><i class="fas fa-check" style="color: var(--color-success);"></i> WiFi 6E Mesh Pro</li>
                                </ul>
                                <button type="button" class="plan-select-btn">
                                    Seleccionar Plan
                                </button>
                            </div>
                        </div>
                        
                        <!-- Resumen del Plan -->
                        <div class="plan-summary" id="planSummary">
                            <h3 style="font-size: 22px; font-weight: 800; color: var(--color-text); margin-bottom: 25px; display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-file-invoice-dollar"></i> Resumen del Plan Seleccionado
                            </h3>
                            
                            <div class="summary-grid">
                                <div>
                                    <div style="font-size: 14px; font-weight: 600; color: var(--color-text-light); text-transform: uppercase; letter-spacing: 1px;">Plan Contratado</div>
                                    <div style="font-size: 20px; font-weight: 800; color: var(--color-text);" id="summaryPlan">Plan Básico</div>
                                </div>
                                
                                <div>
                                    <div style="font-size: 14px; font-weight: 600; color: var(--color-text-light); text-transform: uppercase; letter-spacing: 1px;">Mensualidad</div>
                                    <div style="font-size: 28px; font-weight: 800; color: var(--color-admin);" id="summaryPrice">L 699.00</div>
                                </div>
                                
                                <div>
                                    <div style="font-size: 14px; font-weight: 600; color: var(--color-text-light); text-transform: uppercase; letter-spacing: 1px;">Fecha de Inicio</div>
                                    <div style="font-size: 20px; font-weight: 800; color: var(--color-text);" id="summaryStartDate"></div>
                                </div>
                                
                                <div>
                                    <div style="font-size: 14px; font-weight: 600; color: var(--color-text-light); text-transform: uppercase; letter-spacing: 1px;">Fecha de Vencimiento</div>
                                    <div style="font-size: 20px; font-weight: 800; color: var(--color-text);" id="summaryDueDate"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Fecha de inicio -->
                        <div style="margin-top: 25px;">
                            <div class="form-group">
                                <label>Fecha de Inicio del Plan *</label>
                                <input type="date" class="form-input" id="startDate" required>
                            </div>
                        </div>
                    </div>

                    <!-- Botones -->
                    <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 40px; border-top: 2px solid var(--color-border);">
                        <button type="button" class="btn" id="cancelBtn" style="background: transparent; color: var(--color-danger); border: 2px solid var(--color-danger);">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary" id="saveBtn">
                            <i class="fas fa-save"></i> Guardar Cliente
                        </button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script>
        // ============================================
        // CONFIGURACIÓN INICIAL
        // ============================================
        console.log('Inicializando aplicación...');
        
        // Variables globales
        let selectedPlan = 'basic';
        let selectedPlanPrice = '699';
        
        // Datos de planes
        const plansData = {
            basic: {
                name: "Plan Básico",
                price: "L 699.00",
                monthly: 699
            },
            family: {
                name: "Plan Familiar Pro",
                price: "L 1,199.00",
                monthly: 1199
            },
            premium: {
                name: "Plan Premium Ultra",
                price: "L 1,999.00",
                monthly: 1999
            }
        };
        
        // ============================================
        // INICIALIZAR TODO AL CARGAR LA PÁGINA
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM cargado - inicializando...');
            
            // 1. Configurar fecha automática
            initDate();
            
            // 2. Inicializar tema
            initTheme();
            
            // 3. Configurar selección de planes
            initPlans();
            
            // 4. Configurar formulario
            initForm();
            
            // 5. Actualizar resumen inicial
            updatePlanSummary();
            
            console.log('Aplicación inicializada correctamente');
        });
        
        // ============================================
        // 1. FECHA AUTOMÁTICA
        // ============================================
        function initDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const formattedDate = `${year}-${month}-${day}`;
            
            const dateInput = document.getElementById('startDate');
            if (dateInput) {
                dateInput.value = formattedDate;
                console.log('Fecha automática establecida:', formattedDate);
                
                // Actualizar cuando cambie la fecha
                dateInput.addEventListener('change', updatePlanSummary);
            }
        }
        
        // ============================================
        // 2. SISTEMA DE TEMA CLARO/OSCURO
        // ============================================
        function initTheme() {
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;
            
            if (!themeToggle) {
                console.error('Botón de tema no encontrado');
                return;
            }
            
            // Verificar tema guardado o usar 'light' por defecto
            const savedTheme = localStorage.getItem('theme') || 'light';
            body.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
            
            console.log('Tema inicial:', savedTheme);
            
            // Configurar evento click
            themeToggle.addEventListener('click', function() {
                const currentTheme = body.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                console.log('Cambiando tema de', currentTheme, 'a', newTheme);
                
                // Aplicar nuevo tema
                body.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcon(newTheme);
                
                // Efecto visual
                this.style.transform = 'rotate(180deg) scale(1.1)';
                setTimeout(() => {
                    this.style.transform = 'rotate(0) scale(1)';
                }, 300);
                
                // Mostrar notificación
                showNotification(`Tema cambiado a ${newTheme === 'light' ? 'claro' : 'oscuro'}`, 'success');
            });
        }
        
        function updateThemeIcon(theme) {
            const icon = document.querySelector('#themeToggle i');
            if (!icon) return;
            
            if (theme === 'dark') {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            } else {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }
        }
        
        // ============================================
        // 3. SELECCIÓN DE PLANES
        // ============================================
        function initPlans() {
            const planCards = document.querySelectorAll('.plan-card');
            console.log('Encontradas', planCards.length, 'tarjetas de plan');
            
            planCards.forEach(card => {
                // Evento para hacer clic en toda la tarjeta
                card.addEventListener('click', function(e) {
                    // Evitar que se active cuando se hace clic en el botón
                    if (e.target.classList.contains('plan-select-btn') || 
                        e.target.tagName === 'BUTTON' ||
                        e.target.closest('button')) {
                        return;
                    }
                    
                    selectPlanCard(this);
                });
                
                // Evento para el botón de selección
                const button = card.querySelector('.plan-select-btn');
                if (button) {
                    button.addEventListener('click', function(e) {
                        e.stopPropagation();
                        selectPlanCard(card);
                    });
                }
            });
            
            // Seleccionar el plan básico por defecto
            const basicPlan = document.querySelector('.plan-card[data-plan="basic"]');
            if (basicPlan) {
                selectPlanCard(basicPlan);
            }
        }
        
        function selectPlanCard(card) {
            // Remover selección anterior
            document.querySelectorAll('.plan-card').forEach(c => {
                c.classList.remove('selected');
            });
            
            // Agregar selección nueva
            card.classList.add('selected');
            
            // Actualizar variables globales
            selectedPlan = card.getAttribute('data-plan');
            selectedPlanPrice = card.getAttribute('data-price');
            
            console.log('Plan seleccionado:', selectedPlan, 'Precio:', selectedPlanPrice);
            
            // Actualizar resumen
            updatePlanSummary();
            
            // Mostrar notificación
            const planName = plansData[selectedPlan]?.name || selectedPlan;
            showNotification(`Plan ${planName} seleccionado`, 'success');
        }
        
        // ============================================
        // 4. ACTUALIZAR RESUMEN DEL PLAN
        // ============================================
        function updatePlanSummary() {
            const plan = plansData[selectedPlan];
            if (!plan) {
                console.error('Plan no encontrado:', selectedPlan);
                return;
            }
            
            // Obtener fecha de inicio
            const startDateInput = document.getElementById('startDate');
            let startDate;
            
            if (startDateInput && startDateInput.value) {
                startDate = new Date(startDateInput.value);
            } else {
                startDate = new Date();
            }
            
            // Calcular fecha de vencimiento (30 días después)
            const dueDate = new Date(startDate);
            dueDate.setDate(dueDate.getDate() + 30);
            
            // Formatear fechas
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            };
            
            const formattedStartDate = startDate.toLocaleDateString('es-HN', options);
            const formattedDueDate = dueDate.toLocaleDateString('es-HN', options);
            
            // Actualizar elementos del DOM
            const summaryPlan = document.getElementById('summaryPlan');
            const summaryPrice = document.getElementById('summaryPrice');
            const summaryStartDate = document.getElementById('summaryStartDate');
            const summaryDueDate = document.getElementById('summaryDueDate');
            
            if (summaryPlan) summaryPlan.textContent = plan.name;
            if (summaryPrice) summaryPrice.textContent = plan.price;
            if (summaryStartDate) summaryStartDate.textContent = formattedStartDate;
            if (summaryDueDate) summaryDueDate.textContent = formattedDueDate;
            
            console.log('Resumen actualizado:', {
                plan: plan.name,
                precio: plan.price,
                inicio: formattedStartDate,
                vencimiento: formattedDueDate
            });
        }
        
        // ============================================
        // 5. FORMULARIO Y SUPABASE
        // ============================================
        function initForm() {
            const form = document.getElementById('newClientForm');
            const cancelBtn = document.getElementById('cancelBtn');
            
            if (form) {
                form.addEventListener('submit', handleFormSubmit);
            }
            
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function() {
                    if (confirm('¿Estás seguro de cancelar? Se perderán todos los datos.')) {
                        window.location.href = 'clientes.html';
                    }
                });
            }
        }
        
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            console.log('Procesando formulario...');
            
            // Validar campos requeridos
            const firstName = document.getElementById('firstName').value.trim();
            const firstLastName = document.getElementById('firstLastName').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const address = document.getElementById('address').value.trim();
            const startDate = document.getElementById('startDate').value;
            
            // Validaciones básicas
            if (!firstName || !firstLastName || !email || !phone || !address || !startDate) {
                showNotification('Complete todos los campos requeridos.', 'error');
                return;
            }
            
            if (!validateEmail(email)) {
                showNotification('Ingrese un email válido.', 'error');
                return;
            }
            
            // Mostrar estado de carga
            const saveBtn = document.getElementById('saveBtn');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<span class="loading"></span> Guardando...';
            saveBtn.disabled = true;
            
            try {
                // Preparar datos del cliente
                const plan = plansData[selectedPlan];
                const clienteData = {
                    primer_nombre: firstName,
                    primer_apellido: firstLastName,
                    email: email,
                    telefono: phone,
                    direccion: address,
                    plan: selectedPlan,
                    plan_nombre: plan.name,
                    precio_mensual: plan.monthly,
                    fecha_inicio: startDate,
                    fecha_registro: new Date().toISOString().split('T')[0],
                    // Calcular fecha de vencimiento (30 días)
                    fecha_vencimiento: calcularFechaVencimiento(startDate, 30),
                    estado: 'activo',
                    creado_por: 'Admin',
                    creado_en: new Date().toISOString()
                };
                
                console.log('Datos a guardar:', clienteData);
                
                // Intentar guardar en Supabase
                const supabaseResult = await saveToSupabase(clienteData);
                
                if (supabaseResult.success) {
                    // Éxito en Supabase
                    showNotification('¡Cliente registrado exitosamente en la base de datos!', 'success');
                    
                    // Limpiar formulario después de 2 segundos
                    setTimeout(() => {
                        resetForm();
                        saveBtn.innerHTML = originalText;
                        saveBtn.disabled = false;
                        
                        // Mostrar mensaje adicional
                        showNotification(`Cliente ${firstName} ${firstLastName} ha sido creado.`, 'success');
                    }, 2000);
                    
                } else {
                    // Error en Supabase, guardar localmente
                    console.warn('Guardando localmente:', supabaseResult.error);
                    saveLocally(clienteData);
                    
                    showNotification('Cliente guardado localmente. Se sincronizará después.', 'warning');
                    
                    // Limpiar formulario
                    setTimeout(() => {
                        resetForm();
                        saveBtn.innerHTML = originalText;
                        saveBtn.disabled = false;
                    }, 2000);
                }
                
            } catch (error) {
                console.error('Error general:', error);
                showNotification('Error al procesar el formulario.', 'error');
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            }
        }
        
        // Función para guardar en Supabase
        async function saveToSupabase(clienteData) {
            try {
                // Configuración de Supabase
                const SUPABASE_URL = 'https://vvqxzpjfrsanlhtoemya.supabase.co';
                const SUPABASE_KEY = 'sb_secret_oBJ80J8LKYzqEXrAka5ebQ_8w0TFlYN';
                
                // Crear cliente de Supabase
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                
                // Intentar insertar en diferentes nombres de tabla
                const tablesToTry = ['clientes', 'Clientes', 'usuarios', 'Usuarios'];
                
                for (const tableName of tablesToTry) {
                    try {
                        const { data, error } = await supabase
                            .from(tableName)
                            .insert([clienteData])
                            .select();
                        
                        if (!error) {
                            console.log(`Cliente guardado en tabla "${tableName}":`, data);
                            return { success: true, data: data };
                        }
                    } catch (tableError) {
                        console.log(`Tabla "${tableName}" no disponible:`, tableError.message);
                    }
                }
                
                // Si ninguna tabla funcionó
                return { 
                    success: false, 
                    error: 'No se pudo encontrar una tabla válida en Supabase' 
                };
                
            } catch (error) {
                console.error('Error de conexión a Supabase:', error);
                return { 
                    success: false, 
                    error: error.message 
                };
            }
        }
        
        // Función para guardar localmente
        function saveLocally(clienteData) {
            try {
                // Obtener clientes existentes
                const clientes = JSON.parse(localStorage.getItem('netconnect_clientes') || '[]');
                
                // Agregar ID y timestamp
                clienteData.id = 'local_' + Date.now();
                clienteData.local_saved = new Date().toISOString();
                clienteData.sync_pending = true;
                
                // Guardar
                clientes.push(clienteData);
                localStorage.setItem('netconnect_clientes', JSON.stringify(clientes));
                
                console.log('Cliente guardado localmente:', clienteData);
                return true;
            } catch (error) {
                console.error('Error al guardar localmente:', error);
                return false;
            }
        }
        
        // Función para resetear formulario
        function resetForm() {
            const form = document.getElementById('newClientForm');
            if (form) form.reset();
            
            // Restablecer fecha
            initDate();
            
            // Restablecer plan seleccionado
            const basicPlan = document.querySelector('.plan-card[data-plan="basic"]');
            if (basicPlan) {
                selectPlanCard(basicPlan);
            }
            
            // Actualizar resumen
            updatePlanSummary();
        }
        
        // ============================================
        // FUNCIONES UTILITARIAS
        // ============================================
        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        
        function calcularFechaVencimiento(fechaInicio, dias = 30) {
            const fecha = new Date(fechaInicio);
            fecha.setDate(fecha.getDate() + dias);
            return fecha.toISOString().split('T')[0];
        }
        
        // ============================================
        // SISTEMA DE NOTIFICACIONES
        // ============================================
        function showNotification(message, type = 'info') {
            console.log(`Notificación [${type}]:`, message);
            
            // Crear notificación
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                   type === 'error' ? 'exclamation-circle' : 
                                   type === 'warning' ? 'exclamation-triangle' : 
                                   'info-circle'}"></i>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" style="background:none; border:none; color:white; cursor:pointer; margin-left:auto;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // Agregar al body
            document.body.appendChild(notification);
            
            // Auto-remover después de 5 segundos
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // ============================================
        // FUNCIONES GLOBALES PARA DEBUG
        // ============================================
        window.debugInfo = function() {
            console.log('=== DEBUG INFO ===');
            console.log('Plan seleccionado:', selectedPlan);
            console.log('Precio seleccionado:', selectedPlanPrice);
            console.log('Tema actual:', document.body.getAttribute('data-theme'));
            console.log('Fecha actual:', document.getElementById('startDate')?.value);
            console.log('Clientes locales:', JSON.parse(localStorage.getItem('netconnect_clientes') || '[]').length);
            console.log('==================');
        };
        
        // Mostrar info de debug al cargar
        setTimeout(() => {
            window.debugInfo();
        }, 1000);
        
    </script>
</body>
</html>
